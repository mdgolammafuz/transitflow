version: 2

models:
  - name: int_vehicle_journeys
    description: "Sessionized vehicle journeys with aggregated metrics"
    columns:
      - name: vehicle_id
        data_tests:
          - not_null
      - name: journey_date
        description: "Derived from telemetry ingestion_time"
        data_tests:
          - not_null
      - name: journey_id
        data_tests:
          - not_null
          - unique
      - name: event_count
        data_tests:
          - not_null

  - name: int_stop_performance
    description: "Stop-level performance metrics for ML features. Date and Category derived here."
    columns:
      - name: stop_id
        data_tests:
          - not_null
      - name: date
        description: "Derived from telemetry ingestion_time to recover missing Spark Sink column"
        data_tests:
          - not_null
      - name: line_id
        data_tests:
          - not_null
      - name: hour_of_day
        data_tests:
          - not_null
      - name: day_of_week
        data_tests:
          - not_null
      - name: historical_arrival_count
        data_tests:
          - not_null
      - name: historical_avg_delay
        data_tests:
          - not_null
      - name: delay_category
        description: "Calculated using dbt_project.yml thresholds"
        data_tests:
          - not_null
          - accepted_values:
              values: ['ON_TIME', 'LATE', 'VERY_LATE']
      - name: stddev_delay
        description: "Standard deviation of delay"
      - name: avg_dwell_time_ms
        description: "Average time spent at the stop in milliseconds"
      - name: on_time_percentage
        description: "Historical on-time performance percentage"
      - name: stop_lat
        data_tests:
          - not_null
      - name: stop_lon
        data_tests:
          - not_null