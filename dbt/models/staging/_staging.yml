version: 2

models:
  - name: stg_enriched
    description: "Cleaned and typed enriched events from Bronze layer (Source of Truth for Telemetry)"
    config:
      contract:
        enforced: true
    columns:
      - name: vehicle_id
        data_type: text
      - name: event_time_ms
        data_type: bigint
      - name: event_timestamp
        data_type: timestamp
      - name: latitude
        data_type: double precision
      - name: longitude
        data_type: double precision
      - name: speed_ms
        data_type: double precision
      - name: speed_kmh
        data_type: double precision
      - name: delay_seconds
        data_type: integer
      - name: heading
        data_type: double precision
      - name: door_status
        data_type: integer
      - name: line_id
        data_type: text
      - name: direction_id
        data_type: text
      - name: operator_id
        data_type: text
      - name: next_stop_id
        data_type: text
      - name: delay_trend
        data_type: text
      - name: speed_trend
        data_type: text
      - name: distance_since_last_ms
        data_type: double precision
      - name: time_since_last_ms
        data_type: bigint
      - name: is_stopped
        data_type: boolean
      - name: stopped_duration_ms
        data_type: bigint
      - name: processing_time
        data_type: timestamp
      - name: kafka_partition
        data_type: integer
      - name: kafka_offset
        data_type: bigint
      - name: ingestion_time
        data_type: timestamp
      - name: date
        data_type: date

  - name: stg_stop_events
    description: "Aggregated stop performance metrics from Spark Gold Sink"
    config:
      contract:
        enforced: true
    columns:
      - name: stop_id
        data_type: text
      - name: line_id
        data_type: text
      - name: hour_of_day
        data_type: integer
      - name: day_of_week
        data_type: integer
      - name: historical_arrival_count
        data_type: bigint
      - name: historical_avg_delay
        data_type: double precision
      - name: avg_dwell_time_ms
        data_type: double precision
      - name: stop_lat
        data_type: double precision
      - name: stop_lon
        data_type: double precision
      - name: staging_time
        data_type: timestamp