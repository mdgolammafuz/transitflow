# Dimension Models Configuration
# Pattern: SCD Type 2 - Slowly Changing Dimensions
# Hardening: Aligned with GTFS/Snapshot naming.

version: 2

models:
  - name: dim_stops
    description: "Stop dimension with SCD Type 2 history tracking"
    config:
      contract:
        enforced: true
    columns:
      - name: stop_key
        description: "Surrogate key (MD5 Hash of stop_id + valid_from)"
        data_type: text
        data_tests:
          - unique
          - not_null
          
      - name: stop_id
        description: "Natural key - HSL stop ID (Text to preserve leading zeros)"
        data_type: text
        data_tests:
          - not_null
          
      - name: stop_name
        data_type: text
        data_tests:
          - not_null

      - name: stop_lat
        description: "Ingredient B: Static Latitude (Harden check)"
        data_type: double precision
        data_tests:
          - not_null

      - name: stop_lon
        description: "Ingredient B: Static Longitude (Harden check)"
        data_type: double precision
        data_tests:
          - not_null

      - name: zone_id
        data_type: text

      - name: stop_code
        data_type: text
          
      - name: valid_from
        data_type: timestamp 
        data_tests:
          - not_null
          
      - name: valid_to
        data_type: timestamp 
        data_tests:
          - not_null
          
      - name: is_current
        data_type: boolean
        data_tests:
          - not_null
          - accepted_values:
              values: [true, false]
              quote: false
              
  - name: dim_lines
    description: "Transit line dimension with SCD Type 2 history"
    config:
      contract:
        enforced: true
    columns:
      - name: line_key
        data_type: text
        data_tests:
          - unique
          - not_null
      - name: line_id
        data_type: text
        data_tests:
          - not_null
      - name: line_name
        data_type: text
      - name: line_type
        data_type: text
      - name: operator_name
        data_type: text
      - name: valid_from
        data_type: timestamp
        data_tests:
          - not_null
      - name: valid_to
        data_type: timestamp
        data_tests:
          - not_null
      - name: is_current
        data_type: boolean
        data_tests:
          - not_null