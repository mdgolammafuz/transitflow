version: 2

models:
  - name: fct_stop_arrivals
    description: "Final Feature Store table for API serving - Aggregated Stop Performance"
    config:
      contract:
        enforced: true
    columns:
      - name: feature_id
        data_type: text
        data_tests:
          - unique
          - not_null
      - name: stop_id
        data_type: text
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_stops')
              field: stop_id
              config:
                severity: warn
      - name: line_id
        data_type: text
      - name: hour_of_day
        data_type: integer
      - name: day_of_week
        data_type: integer
      - name: historical_arrival_count
        data_type: bigint
      - name: historical_avg_delay
        data_type: double precision
      - name: historical_stddev_delay
        data_type: double precision
      - name: historical_on_time_pct
        data_type: double precision
      - name: avg_dwell_time_ms
        data_type: double precision
      - name: stop_name
        data_type: text
      - name: zone_id
        data_type: text
      - name: latitude
        data_type: double precision
      - name: longitude
        data_type: double precision
      - name: stop_code
        data_type: text
      - name: line_name
        data_type: text
      - name: line_type
        data_type: text
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: [stop_id, line_id, hour_of_day, day_of_week]

  - name: fct_daily_performance
    description: "Daily aggregated performance metrics by line."
    config:
      contract:
        enforced: true
    columns:
      - name: metric_id
        data_type: text
        data_tests:
          - unique
          - not_null
      - name: line_id
        data_type: text
        data_tests:
          - not_null
      - name: metric_date
        data_type: date
      - name: total_journeys
        data_type: bigint
      - name: total_events
        data_type: bigint
        data_tests:
          - not_null
      - name: unique_vehicles
        data_type: bigint
      - name: avg_delay_seconds
        data_type: double precision
      - name: on_time_percentage
        data_type: double precision
      - name: total_distance_km
        data_type: double precision